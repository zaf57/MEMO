
vesion stable avec dates sur les taches

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MEMO</title>
<link rel="stylesheet" href="style.css">
<link rel="icon" type="image/x-icon" href="MEMO.ico" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
.fade-out { 
  opacity: 0; 
  transition: opacity 0.4s ease-out; 
}
</style>
</head>

<body class="min-h-screen bg-gradient-to-br from-gray-100 to-gray-200 flex flex-col items-center justify-center p-6">

<p id="todayDate" class="text-center text-gray-600 mb-4" style="color: white;"></p>

<div class="bg-white/90 rounded-2xl shadow-xl p-6 max-w-md w-full backdrop-blur" style="background-color: rgb(255, 245, 229);">
  <div class="flex justify-center mt-8">
    <img id="MEMOtransp" src="MEMOtransp.png" alt="Logo MEMO" class="w-32 h-32">
  </div>

  <div class="flex flex-col items-center gap-3 mb-4">
    <button id="voiceBtn" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-2 px-4 rounded-lg">üéôÔ∏è Ajouter une t√¢che</button>
    <button id="readList" class="w-full bg-orange-600 hover:bg-orange-700 text-white py-2 px-4 rounded-lg">üîä Lire les t√¢ches</button>
    <p id="status" class="text-sm text-gray-600 mt-2 text-center">Dis par exemple : ‚ÄúAjoute arroser les plantes‚Äù</p>
    <p id="result" class="text-green-700 font-semibold text-center"></p>
  </div>

  <div id="taskList" class="space-y-2">
    <div class="text-gray-400 text-center">Chargement...</div>
  </div> 
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbwe0ijNVIGxha5SW3OWpk8uBYMHCAqEOSwV0Io-CgIOzL-KIgBHgse0NCiXds1ATWO8dQ/exec";
const taskList = document.getElementById("taskList");
const result = document.getElementById("result");
const status = document.getElementById("status");
const voiceBtn = document.getElementById("voiceBtn");
const today = new Date();
const day = today.getDate();
const month = today.getMonth() + 1; // Mois de 0 √† 11

function speak(text){
  if(!("speechSynthesis" in window)) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang="fr-FR";
  utter.rate=1;
  window.speechSynthesis.speak(utter);
}

async function loadList(){
  try {
    const res = await fetch(scriptURL);
    const data = await res.json();
    taskList.innerHTML = "";
    if(!data || data.length === 0){
      taskList.innerHTML = "<div class='text-gray-500 text-center'>Aucune t√¢che</div>";
      return;
    }
    data.forEach(row=>{
  if(row.tache){
    const div = document.createElement("div");
    div.className="flex justify-between items-center bg-gray-100 p-2 rounded-lg";
    div.innerHTML=`
  <span>‚úÖ ${row.tache} <span class="text-gray-400 text-sm">(${day}/${month})</span></span>
  <button class="delete-btn text-red-600" data-id="${row.id}">üóëÔ∏è</button>
`;
    taskList.appendChild(div);
  }
});

    document.querySelectorAll(".delete-btn").forEach(btn=>{
      btn.addEventListener("click", async e=>{
        const id = Number(e.target.getAttribute("data-id"));
        await deleteTask(id);
      });
    });
  } catch(err){
    taskList.innerHTML="<div class='text-red-500 text-center'>Erreur de chargement</div>";
    console.error(err);
  }
}

async function deleteTask(id){
  const itemDiv = document.querySelector(`.delete-btn[data-id="${id}"]`)?.closest("div");
  if(!itemDiv) return;
  itemDiv.classList.add("fade-out");
  setTimeout(async ()=>{
    try{
      const res = await fetch(scriptURL, {
        method:"POST",
        body: JSON.stringify({action:"delete", id})
      });
      const json = await res.json();
      if(!json.ok) alert("Erreur serveur : "+(json.error||""));
      loadList();
    }catch(err){
      alert("Erreur r√©seau : "+err.message);
    }
  },400);
}

voiceBtn.addEventListener("click", ()=>{
  if(!("webkitSpeechRecognition" in window)){
    alert("La reconnaissance vocale n'est pas support√©e sur ce navigateur (Chrome requis).");
    return;
  }
  const rec = new webkitSpeechRecognition();
  rec.lang="fr-FR";
  rec.start();
  status.textContent="üéß J'√©coute...";
  rec.onresult=async ev=>{
    const phrase = ev.results[0][0].transcript;
    status.textContent="üó£Ô∏è "+phrase;
    try{
      const res = await fetch(scriptURL, {
        method:"POST",
        body: JSON.stringify({action:"add", tache: phrase})
      });
      const json = await res.json();
      if(json.ok){
        result.textContent="T√¢che ajout√©e ‚úÖ";
        speak("T√¢che ajout√©e");
        loadList();
      } else result.textContent="Erreur serveur : "+(json.error||"");
    }catch(err){
      result.textContent="Erreur r√©seau : "+err.message;
    }
  };
  rec.onerror=()=>{status.textContent="‚ùå Erreur de reconnaissance vocale";};
});

document.getElementById("readList").addEventListener("click", async ()=>{
  try{
    const res = await fetch(scriptURL);
    const data = await res.json();
    if(!data || data.length===0){speak("Aucune t√¢che √† lire");return;}
    let phrase="Voici vos t√¢ches : ";
    data.forEach(row=>phrase+=row.tache+", ");
    speak(phrase);
  }catch{ speak("Erreur lors de la lecture"); }
});

document.getElementById("todayDate").textContent = new Date().toLocaleDateString('fr-FR', {weekday:'long', year:'numeric', month:'long', day:'numeric'});

loadList();
</script>

</body>
</html>



APP SCRIPT--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function getTasks() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Taches");
  const data = sheet.getDataRange().getValues();
  data.shift(); // retire l'ent√™te
  return data.map(r => ({
    id: r[0],
    tache: r[1]
  }));
}

function addTask(tache) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Taches");
  const lastRow = sheet.getLastRow();
  const newId = lastRow >= 2 ? sheet.getRange(lastRow, 1).getValue() + 1 : 1;
  sheet.appendRow([newId, tache]);
  return { ok: true };
}

function deleteTask(id) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Taches");
  const values = sheet.getDataRange().getValues();
  for (let i = 1; i < values.length; i++) {
    if (values[i][0] == id) {
      sheet.deleteRow(i + 1);
      return { ok: true };
    }
  }
  return { ok: false, error: "id not found" };
}

function doGet(e) {
  const tasks = getTasks();
  return ContentService.createTextOutput(JSON.stringify(tasks))
    .setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  if (!e || !e.postData || !e.postData.contents) {
    return ContentService.createTextOutput(JSON.stringify({ ok: false, error: "Aucune donn√©e re√ßue" }))
      .setMimeType(ContentService.MimeType.JSON);
  }
  
  try {
    const data = JSON.parse(e.postData.contents);
    let result;
    if (data.action === "add") {
      result = addTask(data.tache);
    } else if (data.action === "delete") {
      result = deleteTask(data.id);
    } else {
      result = { ok: false, error: "Action inconnue" };
    }
    return ContentService.createTextOutput(JSON.stringify(result))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (err) {
    return ContentService.createTextOutput(JSON.stringify({ ok: false, error: err.toString() }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}



</script>

</body>
</html>
